<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Инвестиционный калькулятор</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* ---- Theme variables ---- */
    :root {
      --bg-page:    #0f172a;
      --bg-card:    #1e293b;
      --bg-input:   #0f172a;
      --bg-stat:    #0f172a;
      --bg-bar:     #0f172a;
      --row-hover:  #1e293b55;

      --border-card:  #334155;
      --border-input: #334155;
      --border-stat:  #334155;

      --text-heading:  #f8fafc;
      --text-body:     #e2e8f0;
      --text-label:    #94a3b8;
      --text-muted:    #64748b;
      --text-value:    #f1f5f9;
      --text-td:       #cbd5e1;
      --text-td-first: #94a3b8;

      --btn-bg:           #334155;
      --btn-border:       #475569;
      --btn-color:        #f1f5f9;
      --btn-hover-bg:     #475569;
      --btn-hover-border: #64748b;

      --tab-active-bg:     #334155;
      --tab-active-color:  #f1f5f9;
      --tab-active-border: #475569;
      --tab-inactive:      #64748b;

      --table-header-color:  #64748b;
      --table-header-border: #334155;
      --table-row-border:    #1e293b;

      --scrollbar-track: #0f172a;
      --scrollbar-thumb: #334155;
    }

    body[data-theme="light"] {
      --bg-page:    #f8fafc;
      --bg-card:    #ffffff;
      --bg-input:   #f8fafc;
      --bg-stat:    #f8fafc;
      --bg-bar:     #f1f5f9;
      --row-hover:  #e2e8f055;

      --border-card:  #e2e8f0;
      --border-input: #e2e8f0;
      --border-stat:  #e2e8f0;

      --text-heading:  #0f172a;
      --text-body:     #1e293b;
      --text-label:    #64748b;
      --text-muted:    #94a3b8;
      --text-value:    #0f172a;
      --text-td:       #475569;
      --text-td-first: #64748b;

      --btn-bg:           #e2e8f0;
      --btn-border:       #cbd5e1;
      --btn-color:        #0f172a;
      --btn-hover-bg:     #cbd5e1;
      --btn-hover-border: #94a3b8;

      --tab-active-bg:     #e2e8f0;
      --tab-active-color:  #0f172a;
      --tab-active-border: #cbd5e1;
      --tab-inactive:      #94a3b8;

      --table-header-color:  #94a3b8;
      --table-header-border: #e2e8f0;
      --table-row-border:    #f1f5f9;

      --scrollbar-track: #f1f5f9;
      --scrollbar-thumb: #cbd5e1;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-page);
      color: var(--text-body);
      min-height: 100vh;
      padding: 32px 16px;
      transition: background 0.2s, color 0.2s;
    }

    .page-header {
      position: relative;
      text-align: center;
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-heading);
      letter-spacing: -0.5px;
    }

    .header-btns {
      position: absolute;
      right: 0;
      display: flex;
      gap: 8px;
    }

    .lang-btn, .theme-btn {
      background: var(--btn-bg);
      border: 1px solid var(--btn-border);
      border-radius: 8px;
      color: var(--btn-color);
      font-size: 0.85rem;
      font-weight: 600;
      padding: 6px 14px;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s, color 0.15s;
      letter-spacing: 0.04em;
    }

    .lang-btn:hover, .theme-btn:hover {
      background: var(--btn-hover-bg);
      border-color: var(--btn-hover-border);
    }

    .layout {
      max-width: 1040px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 24px;
      align-items: start;
    }

    @media (max-width: 780px) {
      .layout { grid-template-columns: 1fr; }
      .header-btns { position: static; margin-left: 16px; }
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-card);
      border-radius: 16px;
      padding: 24px;
      transition: background 0.2s, border-color 0.2s;
    }

    .card h2 {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 20px;
    }

    /* ---- Inputs ---- */
    .field { margin-bottom: 18px; }

    label {
      display: block;
      font-size: 0.82rem;
      color: var(--text-label);
      margin-bottom: 6px;
    }

    input[type="number"], select {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--border-input);
      border-radius: 8px;
      color: var(--text-value);
      font-size: 1rem;
      padding: 10px 14px;
      outline: none;
      transition: border-color 0.15s, background 0.2s, color 0.2s;
      appearance: none;
    }

    input[type="number"]:focus, select:focus { border-color: #6366f1; }

    input[type="range"] {
      width: 100%;
      accent-color: #6366f1;
      margin-top: 6px;
    }

    .range-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .range-row input[type="number"] {
      width: 84px;
      flex-shrink: 0;
      padding: 8px 10px;
      font-size: 0.95rem;
    }

    /* ---- Right column ---- */
    .right { display: flex; flex-direction: column; gap: 20px; }

    /* ---- Stats ---- */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .stat {
      background: var(--bg-stat);
      border: 1px solid var(--border-stat);
      border-radius: 10px;
      padding: 14px 16px;
      transition: background 0.2s, border-color 0.2s;
    }

    .stat .label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 5px;
    }

    .stat .value {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text-value);
    }

    .stat .value.green  { color: #34d399; }
    .stat .value.blue   { color: #60a5fa; }
    .stat .value.purple { color: #a78bfa; }

    /* ---- Progress bar ---- */
    .bar-section { margin-top: 4px; }

    .bar-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .bar-track {
      display: flex;
      height: 12px;
      border-radius: 6px;
      overflow: hidden;
      background: var(--bg-bar);
      transition: background 0.2s;
    }

    .bar-c { background: #60a5fa; height: 100%; transition: width 0.4s ease; }
    .bar-i { background: #34d399; height: 100%; transition: width 0.4s ease; }

    .legend {
      display: flex;
      gap: 16px;
      margin-top: 8px;
      font-size: 0.78rem;
      color: var(--text-label);
    }

    .legend span::before {
      content: '';
      display: inline-block;
      width: 9px; height: 9px;
      border-radius: 2px;
      margin-right: 5px;
      vertical-align: middle;
    }

    .legend .c::before { background: #60a5fa; }
    .legend .i::before { background: #34d399; }

    /* ---- Chart ---- */
    .chart-wrap {
      position: relative;
      height: 260px;
    }

    /* ---- Tabs ---- */
    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
    }

    .tab {
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 0.82rem;
      font-weight: 600;
      cursor: pointer;
      background: transparent;
      color: var(--tab-inactive);
      border: 1px solid transparent;
      transition: all 0.15s;
    }

    .tab.active {
      background: var(--tab-active-bg);
      color: var(--tab-active-color);
      border-color: var(--tab-active-border);
    }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* ---- Table ---- */
    table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }

    thead th {
      text-align: left;
      color: var(--table-header-color);
      font-weight: 600;
      padding: 8px 12px;
      border-bottom: 1px solid var(--table-header-border);
    }

    tbody tr { border-bottom: 1px solid var(--table-row-border); }
    tbody tr:hover { background: var(--row-hover); }

    tbody td { padding: 8px 12px; color: var(--text-td); }
    tbody td:first-child { color: var(--text-td-first); }
    tbody td.green { color: #34d399; }
    tbody td.blue  { color: #60a5fa; }

    .table-scroll { max-height: 280px; overflow-y: auto; }
    .table-scroll::-webkit-scrollbar { width: 6px; }
    .table-scroll::-webkit-scrollbar-track { background: var(--scrollbar-track); border-radius: 3px; }
    .table-scroll::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius: 3px; }
  </style>
</head>
<body>

<div class="page-header">
  <h1 data-i18n="title">Инвестиционный калькулятор</h1>
  <div class="header-btns">
    <button class="theme-btn" id="themeBtn" onclick="toggleTheme()">&#9788;</button>
    <button class="lang-btn" id="langBtn" onclick="toggleLang()">EN</button>
  </div>
</div>

<div class="layout">

  <!-- LEFT: Inputs -->
  <div class="card">
    <h2 data-i18n="params">Параметры</h2>

    <div class="field">
      <label data-i18n="labelInitial">Начальная сумма (₽)</label>
      <input type="number" id="initial" value="100000" min="0" step="1000" />
    </div>

    <div class="field">
      <label data-i18n="labelMonthly">Ежемесячное пополнение (₽)</label>
      <input type="number" id="monthly" value="10000" min="0" step="500" />
    </div>

    <div class="field">
      <label data-i18n="labelRate">Годовая доходность (%)</label>
      <div class="range-row">
        <input type="range" id="rateRange" min="0" max="50" step="0.5" value="12" />
        <input type="number" id="rate" value="12" min="0" max="200" step="0.5" />
      </div>
    </div>

    <div class="field">
      <label data-i18n="labelYears">Срок инвестирования (лет)</label>
      <div class="range-row">
        <input type="range" id="yearsRange" min="1" max="50" step="1" value="10" />
        <input type="number" id="years" value="10" min="1" max="100" step="1" />
      </div>
    </div>

    <div class="field">
      <label data-i18n="labelFreq">Капитализация</label>
      <select id="freq">
        <option value="12" data-i18n="freqMonthly">Ежемесячно</option>
        <option value="4"  data-i18n="freqQuarterly">Ежеквартально</option>
        <option value="2"  data-i18n="freqSemiannual">Раз в полгода</option>
        <option value="1"  data-i18n="freqAnnual">Ежегодно</option>
      </select>
    </div>
  </div>

  <!-- RIGHT: Results -->
  <div class="right">

    <!-- Stats card -->
    <div class="card">
      <h2 data-i18n="results">Итог</h2>
      <div class="stats-grid">
        <div class="stat">
          <div class="label" data-i18n="statFinal">Итоговый капитал</div>
          <div class="value purple" id="sFinal">—</div>
        </div>
        <div class="stat">
          <div class="label" data-i18n="statContrib">Всего внесено</div>
          <div class="value blue" id="sContrib">—</div>
        </div>
        <div class="stat">
          <div class="label" data-i18n="statIncome">Доход от инвестиций</div>
          <div class="value green" id="sIncome">—</div>
        </div>
        <div class="stat">
          <div class="label" data-i18n="statPct">Доходность на вложения</div>
          <div class="value green" id="sPct">—</div>
        </div>
      </div>
      <div class="bar-section" style="margin-top:16px">
        <div class="bar-label" data-i18n="barLabel">Структура капитала</div>
        <div class="bar-track">
          <div class="bar-c" id="barC" style="width:50%"></div>
          <div class="bar-i" id="barI" style="width:50%"></div>
        </div>
        <div class="legend">
          <span class="c" id="legC">Взносы</span>
          <span class="i" id="legI">Доход</span>
        </div>
      </div>
    </div>

    <!-- Chart + Table card -->
    <div class="card">
      <div class="tabs">
        <button class="tab active" data-tab="chart" data-i18n="tabChart">График</button>
        <button class="tab" data-tab="table" data-i18n="tabTable">По годам</button>
      </div>

      <div class="tab-panel active" id="tab-chart">
        <div class="chart-wrap">
          <canvas id="growthChart"></canvas>
        </div>
      </div>

      <div class="tab-panel" id="tab-table">
        <div class="table-scroll">
          <table>
            <thead>
              <tr>
                <th data-i18n="thYear">Год</th>
                <th data-i18n="thContrib">Взносы</th>
                <th data-i18n="thIncome">Доход</th>
                <th data-i18n="thTotal">Итог</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  /* ---- Translations ---- */
  const i18n = {
    ru: {
      title:          'Инвестиционный калькулятор',
      params:         'Параметры',
      labelInitial:   'Начальная сумма (₽)',
      labelMonthly:   'Ежемесячное пополнение (₽)',
      labelRate:      'Годовая доходность (%)',
      labelYears:     'Срок инвестирования (лет)',
      labelFreq:      'Капитализация',
      freqMonthly:    'Ежемесячно',
      freqQuarterly:  'Ежеквартально',
      freqSemiannual: 'Раз в полгода',
      freqAnnual:     'Ежегодно',
      results:        'Итог',
      statFinal:      'Итоговый капитал',
      statContrib:    'Всего внесено',
      statIncome:     'Доход от инвестиций',
      statPct:        'Доходность на вложения',
      barLabel:       'Структура капитала',
      contributions:  'Взносы',
      income:         'Доход',
      tabChart:       'График',
      tabTable:       'По годам',
      thYear:         'Год',
      thContrib:      'Взносы',
      thIncome:       'Доход',
      thTotal:        'Итог',
      xAxisTitle:     'Год',
      tooltipTotal:   'Итог',
      millionSuffix:  ' млн ₽',
      currencySuffix: ' ₽',
      locale:         'ru-RU',
    },
    en: {
      title:          'Investment Calculator',
      params:         'Parameters',
      labelInitial:   'Initial amount (₽)',
      labelMonthly:   'Monthly contribution (₽)',
      labelRate:      'Annual return (%)',
      labelYears:     'Investment period (years)',
      labelFreq:      'Compounding',
      freqMonthly:    'Monthly',
      freqQuarterly:  'Quarterly',
      freqSemiannual: 'Semi-annually',
      freqAnnual:     'Annually',
      results:        'Results',
      statFinal:      'Final capital',
      statContrib:    'Total contributed',
      statIncome:     'Investment income',
      statPct:        'Return on investment',
      barLabel:       'Capital structure',
      contributions:  'Contributions',
      income:         'Income',
      tabChart:       'Chart',
      tabTable:       'By year',
      thYear:         'Year',
      thContrib:      'Contributions',
      thIncome:       'Income',
      thTotal:        'Total',
      xAxisTitle:     'Year',
      tooltipTotal:   'Total',
      millionSuffix:  ' M ₽',
      currencySuffix: ' ₽',
      locale:         'en-US',
    },
  };

  let lang = 'ru';

  /* ---- Apply language ---- */
  function applyLang() {
    const t = i18n[lang];

    // Static text elements
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.dataset.i18n;
      if (t[key] !== undefined) el.textContent = t[key];
    });

    // Chart dataset labels and axis title
    chart.data.datasets[0].label = t.contributions;
    chart.data.datasets[1].label = t.income;
    chart.options.scales.x.title.text = t.xAxisTitle;

    // Page meta
    document.documentElement.lang = lang;
    document.title = t.title;

    // Lang button label shows the opposite language
    document.getElementById('langBtn').textContent = lang === 'ru' ? 'EN' : 'RU';

    // Recalculate to refresh dynamic content with new language
    calculate();
  }

  function toggleLang() {
    lang = lang === 'ru' ? 'en' : 'ru';
    applyLang();
  }

  /* ---- Formatting ---- */
  function fmt(n) {
    const t = i18n[lang];
    if (n >= 1_000_000) return (n / 1_000_000).toLocaleString(t.locale, { maximumFractionDigits: 2 }) + t.millionSuffix;
    return n.toLocaleString(t.locale, { maximumFractionDigits: 0 }) + t.currencySuffix;
  }
  function fmtFull(n) {
    const t = i18n[lang];
    return n.toLocaleString(t.locale, { maximumFractionDigits: 0 }) + t.currencySuffix;
  }

  /* ---- Sync range/number pairs ---- */
  function bindPair(rangeId, numberId) {
    const range = document.getElementById(rangeId);
    const num   = document.getElementById(numberId);
    range.addEventListener('input', () => { num.value = range.value; calculate(); });
    num.addEventListener('input', () => {
      range.value = Math.min(parseFloat(num.value) || 0, parseFloat(range.max));
      calculate();
    });
  }

  bindPair('rateRange', 'rate');
  bindPair('yearsRange', 'years');
  document.getElementById('initial').addEventListener('input', calculate);
  document.getElementById('monthly').addEventListener('input', calculate);
  document.getElementById('freq').addEventListener('change', calculate);

  /* ---- Chart ---- */
  const ctx = document.getElementById('growthChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [],
      datasets: [
        {
          label: 'Взносы',
          data: [],
          backgroundColor: '#3b82f6aa',
          borderColor: '#60a5fa',
          borderWidth: 1,
          borderRadius: 3,
        },
        {
          label: 'Доход',
          data: [],
          backgroundColor: '#10b98199',
          borderColor: '#34d399',
          borderWidth: 1,
          borderRadius: 3,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 300 },
      interaction: { mode: 'index' },
      plugins: {
        legend: {
          labels: { color: '#94a3b8', font: { size: 12 }, boxWidth: 12, padding: 16 },
        },
        tooltip: {
          backgroundColor: '#1e293b',
          borderColor: '#334155',
          borderWidth: 1,
          titleColor: '#f1f5f9',
          bodyColor: '#94a3b8',
          callbacks: {
            label(ctx) {
              return ` ${ctx.dataset.label}: ${fmtFull(ctx.parsed.y)}`;
            },
            afterBody(items) {
              const total = items.reduce((s, i) => s + i.parsed.y, 0);
              return [` ${i18n[lang].tooltipTotal}: ${fmtFull(total)}`];
            },
          },
        },
      },
      scales: {
        x: {
          stacked: true,
          ticks: { color: '#64748b', font: { size: 11 } },
          grid: { color: '#1e293b' },
          title: { display: true, text: 'Год', color: '#64748b', font: { size: 11 } },
        },
        y: {
          stacked: true,
          ticks: {
            color: '#64748b',
            font: { size: 11 },
            callback(v) { return fmt(v); },
          },
          grid: { color: '#334155' },
        },
      },
    },
  });

  /* ---- Theme ---- */
  const chartThemes = {
    dark: {
      legendColor:   '#94a3b8',
      tooltipBg:     '#1e293b',
      tooltipBorder: '#334155',
      tooltipTitle:  '#f1f5f9',
      tooltipBody:   '#94a3b8',
      xTickColor:    '#64748b',
      xGridColor:    '#1e293b',
      xTitleColor:   '#64748b',
      yTickColor:    '#64748b',
      yGridColor:    '#334155',
    },
    light: {
      legendColor:   '#64748b',
      tooltipBg:     '#ffffff',
      tooltipBorder: '#e2e8f0',
      tooltipTitle:  '#0f172a',
      tooltipBody:   '#64748b',
      xTickColor:    '#94a3b8',
      xGridColor:    '#f1f5f9',
      xTitleColor:   '#94a3b8',
      yTickColor:    '#94a3b8',
      yGridColor:    '#e2e8f0',
    },
  };

  let theme = localStorage.getItem('theme') || 'dark';

  function applyTheme() {
    if (theme === 'light') {
      document.body.setAttribute('data-theme', 'light');
      document.getElementById('themeBtn').textContent = '\u263D'; // crescent moon
    } else {
      document.body.removeAttribute('data-theme');
      document.getElementById('themeBtn').textContent = '\u2600'; // sun
    }

    const c = chartThemes[theme];
    chart.options.plugins.legend.labels.color = c.legendColor;
    chart.options.plugins.tooltip.backgroundColor = c.tooltipBg;
    chart.options.plugins.tooltip.borderColor = c.tooltipBorder;
    chart.options.plugins.tooltip.titleColor = c.tooltipTitle;
    chart.options.plugins.tooltip.bodyColor = c.tooltipBody;
    chart.options.scales.x.ticks.color = c.xTickColor;
    chart.options.scales.x.grid.color = c.xGridColor;
    chart.options.scales.x.title.color = c.xTitleColor;
    chart.options.scales.y.ticks.color = c.yTickColor;
    chart.options.scales.y.grid.color = c.yGridColor;
    chart.update('none');

    localStorage.setItem('theme', theme);
  }

  function toggleTheme() {
    theme = theme === 'dark' ? 'light' : 'dark';
    applyTheme();
  }

  /* ---- Calculate ---- */
  function calculate() {
    const t = i18n[lang];

    const initial    = parseFloat(document.getElementById('initial').value) || 0;
    const monthly    = parseFloat(document.getElementById('monthly').value) || 0;
    const annualRate = parseFloat(document.getElementById('rate').value)    || 0;
    const years      = parseInt(document.getElementById('years').value)     || 1;
    const freq       = parseInt(document.getElementById('freq').value);

    const ratePerPeriod  = annualRate / 100 / freq;
    const monthsPerPeriod = 12 / freq;

    let balance = initial;
    const rows  = [];

    for (let y = 1; y <= years; y++) {
      for (let p = 0; p < freq; p++) {
        balance += monthly * monthsPerPeriod;
        balance *= (1 + ratePerPeriod);
      }
      const totalContributed = initial + monthly * 12 * y;
      const interest = balance - totalContributed;
      rows.push({ year: y, contributed: totalContributed, interest, balance });
    }

    const finalBalance    = balance;
    const totalContributed = initial + monthly * 12 * years;
    const totalInterest   = finalBalance - totalContributed;
    const interestPct     = totalContributed > 0
      ? ((totalInterest / totalContributed) * 100).toFixed(1)
      : '0.0';

    const cw = Math.round((totalContributed / finalBalance) * 100);
    const iw = 100 - cw;

    /* Stats */
    document.getElementById('sFinal').textContent   = fmt(finalBalance);
    document.getElementById('sContrib').textContent = fmt(totalContributed);
    document.getElementById('sIncome').textContent  = fmt(totalInterest);
    document.getElementById('sPct').textContent     = '+' + interestPct + '%';

    document.getElementById('barC').style.width = cw + '%';
    document.getElementById('barI').style.width = iw + '%';
    document.getElementById('legC').textContent = `${t.contributions} — ${cw}%`;
    document.getElementById('legI').textContent = `${t.income} — ${iw}%`;

    /* Chart */
    const step = years > 30 ? 5 : years > 20 ? 2 : 1;
    const filtered = rows.filter(r => r.year % step === 0 || r.year === years);

    chart.data.labels = filtered.map(r => r.year);
    chart.data.datasets[0].data = filtered.map(r => r.contributed);
    chart.data.datasets[1].data = filtered.map(r => r.interest);
    chart.update();

    /* Table */
    document.getElementById('tableBody').innerHTML = rows.map(r => `
      <tr>
        <td>${r.year}</td>
        <td class="blue">${fmtFull(r.contributed)}</td>
        <td class="green">${fmtFull(r.interest)}</td>
        <td><strong>${fmtFull(r.balance)}</strong></td>
      </tr>
    `).join('');
  }

  /* ---- Tabs ---- */
  document.querySelectorAll('.tab').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
      if (btn.dataset.tab === 'chart') chart.resize();
    });
  });

  /* ---- Init ---- */
  calculate();
  applyTheme();
</script>

</body>
</html>
